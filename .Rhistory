theme(axis.title.x=element_blank())+
theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
#theme_bw()+
#facet_grid(date~.,space="free")+
geom_jitter(position=position_jitter(width=.1, height=0),aes(color=coral),size=3)+
scale_color_manual(values=cols)+
theme(axis.title.x=element_blank())+
theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
#facet_grid(date~.,space="free")+
geom_jitter(position=position_jitter(width=.1, height=0),aes(color=coral),size=3)+
scale_color_manual(values=c("#000000","#999999","#D55E00","#E69F00","#0072B2","#56B4E9"))+
theme(axis.title.x=element_blank())+
theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
#facet_grid(date~.,space="free")+
geom_jitter(position=position_jitter(width=.1, height=0),aes(color=coral),size=3)+
scale_color_manual(values=c("#000000","#999999","#D55E00","#E69F00","#0072B2","#56B4E9"))+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
#facet_grid(date~.,space="free")+
geom_jitter(position=position_jitter(width=.1, height=0),aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
#facet_grid(date~.,space="free")+
geom_jitter(position=position_jitter(width=.1, height=0),aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
scale_shape_manual(values=c(21,22,23,24))+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance,shape=samples$coral))+
geom_boxplot()+
theme_bw()+
#facet_grid(date~.,space="free")+
geom_jitter(position=position_jitter(width=.1, height=0),aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
scale_shape_manual(values=c(21,22,23,24))+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance,shape=dis.treat$coral))+
geom_boxplot()+
theme_bw()+
#facet_grid(date~.,space="free")+
geom_jitter(position=position_jitter(width=.1, height=0),aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
scale_shape_manual(values=c(21,22,23,24))+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance,shape=coral))+
geom_boxplot()+
theme_bw()+
#facet_grid(date~.,space="free")+
geom_jitter(position=position_jitter(width=.1, height=0),aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
scale_shape_manual(values=c(21,22,23,24))+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
#facet_grid(date~.,space="free")+
geom_jitter(position=position_jitter(width=.1, height=0),aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
#facet_grid(date~.,space="free")+
#geom_jitter(position=position_jitter(width=.1, height=0),aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
#facet_grid(date~.,space="free")+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")+
labs(fill="Coral")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
scale_fill_discrete(name="Coral")
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
scale_fill_discrete(name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"))+
scale_color_discrete(name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
pdf("DistanceToCentroid.pdf",width=8.5,height=11)
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
dev.off()
View(taxon)
pdf("DistanceToCentroid.pdf",width=8.5)
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
dev.off()
pdf("DistanceToCentroid.pdf",width=4)
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
dev.off()
pdf("DistanceToCentroid.pdf",width=4, height=4)
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
dev.off()
pdf("DistanceToCentroid.pdf",width=4, height=6)
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
dev.off()
pdf("DistanceToCentroid.pdf",width=6, height=4)
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#999999","#56B4E9","#0072B2","#009E73"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
dev.off()
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#F0E442","#E69F00","#D55E00","#CC79A7"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_fill_manual(values=c("#F0E442","#E69F00","#D55E00","#CC79A7"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#F0E442","#E69F00","#D55E00","#CC79A7"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#F0E442","#009E73","#CC79A7","#CCCCCC"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
pdf("DistanceToCentroid.pdf",width=6, height=4)
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#F0E442","#009E73","#CC79A7","#CCCCCC"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
dev.off()
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#F0E442","#009E73","#CC79A7","#666666"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
pdf("DistanceToCentroid.pdf",width=6, height=4)
p3<-ggplot(dis.treat,aes(x=date,y=distance))+
geom_boxplot()+
theme_bw()+
geom_point(aes(color=coral),size=3)+
scale_color_manual(values=c("#F0E442","#009E73","#CC79A7","#666666"),name="Coral")+
theme(axis.title.x=element_blank())+
#theme(legend.position="none")+
theme(text=element_text(size=14))+
theme(strip.text.y=element_text(face="italic",size=14))+
ylab("Distance to Centroid")
p3
dev.off()
n <- 60
palette <- distinctColorPalette(n)
sample_data(ps_ra)$coral<-factor(sample_data(ps_ra)$coral,levels=c("coral_25","coral_26","coral_27","coral_28"))
otu <- read.table("silva_nochloronomito_otu_table.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_tank.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps
##### bar charts
ps_ra<-transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
get_taxa_unique(ps_ra, "Class") #60
n <- 60
palette <- distinctColorPalette(n)
sample_data(ps_ra)$coral<-factor(sample_data(ps_ra)$coral,levels=c("coral_25","coral_26","coral_27","coral_28"))
sample_data(ps_ra)$date<-factor(sample_data(ps_ra)$date,levels=c("pre","1day","3days","7days","21days","28days"))
p1=plot_bar(ps_ra, "date", fill="Class", facet_grid=.~coral)+
geom_bar(aes(fill=Class), stat="identity",position="stack")+
theme(strip.text=element_text(face="bold"))+
theme(axis.text.x=element_text(angle = 90))+
scale_fill_manual(values=palette)+
theme(plot.title = element_text(face="italic"))+
theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
p1=plot_bar(ps_ra, "date", fill="Class", facet_grid=.~coral)+
geom_bar(aes(fill=Class), stat="identity",position="stack")+
theme_bw()+
theme(strip.text=element_text(face="bold"))+
theme(axis.text.x=element_text(angle = 90))+
scale_fill_manual(values=palette)+
theme(plot.title = element_text(face="italic"))+
theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
pdf("barchart_Class.pdf",width=13)
p1=plot_bar(ps_ra, "date", fill="Class", facet_grid=.~coral)+
geom_bar(aes(fill=Class), stat="identity",position="stack")+
theme_bw()+
theme(strip.text=element_text(face="bold"))+
theme(axis.text.x=element_text(angle = 90))+
scale_fill_manual(values=palette)+
theme(plot.title = element_text(face="italic"))+
theme(axis.title.x = element_blank())+
theme(legend.position = "bottom")
p1
dev.off()
knitr::opts_chunk$set(echo = TRUE)
###################### Perform center-log-ratio transformation on ASVs and calculate Aitchison Distance and principal components
otu <- read.table("silva_nochloronomito_otu_table.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_tank.txt",sep="\t",header=T,row.names=1)
# First, replace 0 values with an estimate (because normalization is taking log, can't have 0)
# Also transposing here, need samples as rows
d.czm <- cmultRepl(t(otu), method="CZM", label=0)
library(dada2)
library(ShortRead)
library(ggplot2)
library(phyloseq)
library(vegan)
library(knitr)
library(ALDEx2)
library(CoDaSeq)
library(zCompositions)
library(igraph)
library(car)
library(grDevices)
library(propr)
library(cowplot)
library(randomcoloR)
library(dplyr)
library(reshape2)
library(tibble)
library(exactRankTests)
library(nlme)
library(data.table)
library(Rmisc)
writeLines(capture.output(sessionInfo()), "sessionInfo.txt")
###################### Perform center-log-ratio transformation on ASVs and calculate Aitchison Distance and principal components
otu <- read.table("silva_nochloronomito_otu_table.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_tank.txt",sep="\t",header=T,row.names=1)
# First, replace 0 values with an estimate (because normalization is taking log, can't have 0)
# Also transposing here, need samples as rows
d.czm <- cmultRepl(t(otu), method="CZM", label=0)
# Perform the center-log-ratio (CLR) transformation
d.clr <- codaSeq.clr(d.czm)
# transpose matrix of CLR transformed data for ordination and dendrogram
E.clr <- t(d.clr)
# plot compositional PCA biplot (perform a singular value decomposition)
d.pcx <- prcomp(E.clr)
# calculate percent variance explained for the axis labels
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
biplot(d.pcx, cex=c(0.6,0.4), var.axes=F,scale=1, xlab=xlab, ylab=ylab)
summary(d.pcx)
str(d.pcx)
screeplot(d.pcx)
# replot PCA with ggplot2 (showing samples only)
df_out <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("pre"="#000000","1day"="#999999","3days"="#D55E00","7days"="#E69F00","21days"="#0072B2","28days"="#56B4E9")
samples$coral<-factor(samples$coral,levels=c("coral_25","coral_26","coral_27","coral_28"))
samples$date<-factor(samples$date,levels=c("pre","1day","3days","7days","21days","28days"))
pdf("PCA.pdf",width=8.5)
p<-ggplot(df_out,aes(x=PC1,y=PC2,fill=samples$date,shape=samples$coral))
p<-p+geom_point(size=5)+theme(axis.title = element_text(size=14))+theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+theme(legend.text = element_text(size=12))+
scale_fill_manual(values=cols)+
scale_shape_manual(values=c(21,22,23,24))+
guides(fill = guide_legend(override.aes=list(shape=21)))
p + labs(x=xlab, y=ylab, fill="Date", shape="Coral") + coord_fixed()
dev.off()
###################### Use phyloseq/vegan to perform ANOSIM/PERMANOVA
# set metadata as factors for anosim
coral<-as.character(samples$coral)
date<-as.character(samples$date)
# permanova between groups using Aitchison distance
dist.clr <- dist(E.clr)
perm<-adonis(dist.clr~coral*date,as(sample_data(ps),"data.frame"))
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps
perm<-adonis(dist.clr~coral*date,as(sample_data(ps),"data.frame"))
print(perm)
mod<-betadisper(dist.clr,date)
anova(mod)
plot(mod)
boxplot(mod)
tapply(mod$distances, date, mean)
dis <- mod$distances
dis.melt <- melt(dis)
dis.melt$Sample <- rownames(dis.melt)
samples$Sample <- rownames(samples)
dis.treat <- merge(samples, dis.melt)
colnames(dis.treat)[4] <- "distance"
distlm <-lm(distance~date*coral, data=dis.treat)
summary(distlm)
anova(distlm)
